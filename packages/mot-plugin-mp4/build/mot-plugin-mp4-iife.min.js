!function(e){"use strict";function t(e){return new Promise(((t,r)=>{const i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onload=function(){200==this.status?t(this.response):r(this)},i.send()}))}const r=new Uint8Array([102,116,121,112,105,115,111,109]);class i{constructor(){this.mvhd={},this.trak=[]}checkSignature(e){for(let t=0;t<r.length;t++)if(r[t]!=e[t])return!1;return!0}parseChunks(e){let t=new Uint8Array(e),r=32,i=0;for(;r<t.length&&i<20;){i++;const e=this.getSize(t,r);switch(console.log(this.getBoxType(t,r+4),e),this.getBoxType(t,r+4)){case"free":case"mdat":r+=e;break;case"moov":r+=8;break;case"mvhd":this.mvhdParser(t,r),r+=e;break;case"trak":this.trak.push({}),r+=8;break;case"tkhd":this.tkhdParser(t,r),this.trak[this.trak.length-1].tkhd={},r+=e;break;case"mdia":this.trak[this.trak.length-1].mdia={},r+=8;break;case"mdhd":this.mdhdParser(t,r),r+=e;break;case"hdlr":r+=e;break;case"minf":r+=8;break;case"smhd":case"dinf":case"stbl":default:r+=e}}}getBoxType(e,t,r=4){let i=Array.prototype.slice.call(e.subarray(t,t+r));return String.fromCharCode.apply(String,i)}getSize(e,t,r=4){let i=0;i+=e[0+t]<<24>>>0;for(let s=1;s<r;s++)i+=e[s+t]<<8*(r-1-s);return i}get16Int16FLOAT(e,t){let r=0,i=0;for(let i=0;i<2;i++)r+=e[i+t]<<8*(1-i);for(let r=2;r<4;r++)i+=e[r+t]<<8*(3-r);return Number(`${r}.${i}`)}get8INT8FLOAT(e,t){let r=0,i=0;return r+=e[t],i+=e[t],Number(`${r}.${i}`)}mvhdParser(e,t){let r={version:0,flags:[],createTime:"",modifyTime:"",timeScale:"",duration:0,rate:1};t+=8,r.version=e[t],t+=1,r.flags=e.slice(t,t+3),t+=3,r.createTime=this.getSize(e,t),t+=4,r.modifyTime=this.getSize(e,t),t+=4,r.timeScale=this.getSize(e,t),t+=4,r.duration=this.getSize(e,t),t+=4,r.rate=this.get16Int16FLOAT(e,t),t+=4,r.volume=this.get8INT8FLOAT(e,t),t+=2,t+=10,r.matrix=e.slice(t,t+36),t+=36,t+=24,r.nextTrackId=this.getSize(e,t),t+=4}tkhdParser(e,t){let r={};return t+=8,r.version=e[t],t+=1,r.flags=e.slice(t,t+3),t+=3,r.createTime=this.getSize(e,t),t+=4,r.modifyTime=this.getSize(e,t),t+=4,r.trackId=this.getSize(e,t),t+=4,t+=4,r.duration=this.getSize(e,t),t+=4,t+=8,r.layer=0,console.log(e.slice(t,t+2)),t+=2,r.alternateGroup=0,t+=2,r.volume=this.get8INT8FLOAT(e,t),t+=2,t+=2,r.matrix=e.slice(t,t+36),t+=36,r.width=this.get16Int16FLOAT(e,t),t+=4,r.height=this.get16Int16FLOAT(e,t),t+=4,r}mdhdParser(e,t){let r={version:0,flags:new Uint8Array,createTime:0,modifyTime:0,timeScale:0,duration:0,language:new Uint8Array};return t+=8,r.version=e[t],t+=1,r.flags=e.slice(t,t+3),t+=3,r.createTime=this.getSize(e,t),t+=4,r.modifyTime=this.getSize(e,t),t+=4,r.timeScale=this.getSize(e,t),t+=4,r.duration=this.getSize(e,t),t+=4,r.language=e.slice(t,t+2),t+=2,t+=2,r}}class s{constructor(e,t){this.loadUrl(e)}loadUrl(e){t(e).then((e=>{console.log(e),console.log(e.slice(4,12)),this.parse(e)})).catch((e=>[console.error(e)]))}parse(e){let t=new i;t.checkSignature(new Uint8Array(e.slice(4,12)))?(t.parseChunks(e),console.log(t)):console.error("filetype should be mp4")}}window.MP4Render&&console.warn("'MP4Render' had been used,and it will be covered"),window.MP4Render=s,e.Loader=t,e.MP4Render=s,e.Parser=i,Object.defineProperty(e,"__esModule",{value:!0})}({});
