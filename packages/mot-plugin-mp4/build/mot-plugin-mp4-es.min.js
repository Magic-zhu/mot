function e(e){return new Promise(((t,r)=>{const i=new XMLHttpRequest;i.open("GET",e),i.responseType="arraybuffer",i.onload=function(){200==this.status?t(this.response):r(this)},i.send()}))}const t=new Uint8Array([102,116,121,112,105,115,111,109]);class r{checkSignature(e){for(let r=0;r<t.length;r++)if(t[r]!=e[r])return!1;return!0}splitChunks(e){let t=new Uint8Array(e),r=32,i={version:0,flags:[],createTime:"",modifyTime:"",timeScale:"",duration:0,rate:1},s=0;for(;r<t.length&&s<20;){s++;const e=this.getSize(t,r);switch(console.log(this.getBoxType(t,r+4),e),this.getBoxType(t,r+4)){case"free":case"mdat":r+=e;break;case"moov":r+=8;break;case"mvhd":r+=8,i.version=t[r],r+=1,i.flags=t.slice(r,r+3),r+=3,i.createTime=this.getSize(t,r),r+=4,i.modifyTime=this.getSize(t,r),r+=4,i.timeScale=this.getSize(t,r),r+=4,i.duration=this.getSize(t,r),r+=4,i.rate="lalala",r+=4,i.volume="lalalal",r+=12,i.matrix=t.slice(r,r+36),r+=36,r+=24,i.nextTrackId=this.getSize(t,r),r+=4,console.log(i);break;case"trak":r+=8;break;case"tkhd":let s={};r+=8,s.version=t[r],r+=1,s.flags=t.slice(r,r+3),r+=3,s.createTime=this.getSize(t,r),r+=4,s.modifyTime=this.getSize(t,r),r+=4,s.trackId=this.getSize(t,r),r+=4,r+=4,s.duration=this.getSize(t,r),r+=4,r+=8,s.layer=0,console.log(t.slice(r,r+2)),r+=2,s.alternateGroup=0,r+=2,s.volume=0,r+=2,r+=2,s.matrix=t.slice(r,r+36),r+=36,s.width=this.get16Int16FLOAT(t,r),r+=4,s.height=this.get16Int16FLOAT(t,r),r+=4,console.log(s);break;default:r+=e}}}parseChunks(e,t){}getBoxType(e,t){let r=Array.prototype.slice.call(e.subarray(t,t+4));return String.fromCharCode.apply(String,r)}getSize(e,t){let r=0;r+=e[0+t]<<24>>>0;for(let i=1;i<4;i++)r+=e[i+t]<<8*(3-i);return r}get16Int16FLOAT(e,t){let r=0,i=0;for(let i=0;i<2;i++)r+=e[i+t]<<8*(1-i);for(let r=2;r<4;r++)i+=e[r+t]<<8*(3-r);return Number(`${r}.${i}`)}}class i{constructor(e,t){this.loadUrl(e)}loadUrl(t){e(t).then((e=>{console.log(e),console.log(e.slice(4,12)),this.parse(e)})).catch((e=>[console.error(e)]))}parse(e){let t=new r;t.checkSignature(new Uint8Array(e.slice(4,12)))?t.splitChunks(e):console.error("filetype should be mp4")}}window.MP4Render&&console.warn("'MP4Render' had been used,and it will be covered"),window.MP4Render=i;export{e as Loader,i as MP4Render,r as Parser};
